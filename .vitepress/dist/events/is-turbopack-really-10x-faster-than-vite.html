<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Is Turbopack really 10x Faster than Vite? | Vrite</title>
    <meta name="description" content="Vite Art">
    <link rel="preload stylesheet" href="/assets/style.ac216bba.css" as="style">
    <script type="module" src="/assets/app.1fa2887a.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/assets/chunks/framework.fed62f4c.js">
  <link rel="modulepreload" href="/assets/chunks/theme.c15c5072.js">
  <link rel="modulepreload" href="/assets/events_is-turbopack-really-10x-faster-than-vite.md.c82d7d7e.lean.js">
  <meta name="theme-color" content="#3c8772">
  <script src="https://cdn.usefathom.com/script.js" data-site="AZBRSFGG" data-spa="auto" defer=""></script>
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b8b11faa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-b8b11faa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar" data-v-7e5bc4a5 data-v-7683ced7><div class="container" data-v-7683ced7><div class="title" data-v-7683ced7><div class="VPNavBarTitle" data-v-7683ced7 data-v-4d981103><a class="title" href="/" data-v-4d981103><!--[--><!--]--><!----><!--[-->Vrite<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-7683ced7><div class="curtain" data-v-7683ced7></div><div class="content-body" data-v-7683ced7><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-7683ced7><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-7683ced7 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/overview" tabindex="0" data-v-7f418b0f data-v-5e623618 data-v-8f4dc553><!--[-->Guide<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/plugin/inside/plugin-legacy" tabindex="0" data-v-7f418b0f data-v-5e623618 data-v-8f4dc553><!--[-->Plugin<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-7683ced7 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-82b282f1 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-82b282f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-82b282f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-7683ced7 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink" href="https://github.com/XiSenao" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-36371990><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-7683ced7 data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-82b282f1 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-82b282f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-82b282f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink" href="https://github.com/XiSenao" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-36371990><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-7683ced7 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPDoc has-aside" data-v-a494bd1d data-v-c4b0d3cf><!--[--><!--]--><div class="container" data-v-c4b0d3cf><div class="aside" data-v-c4b0d3cf><div class="aside-curtain" data-v-c4b0d3cf></div><div class="aside-container" data-v-c4b0d3cf><div class="aside-content" data-v-c4b0d3cf><div class="VPDocAside" data-v-c4b0d3cf data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-9a431c33><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c4b0d3cf><div class="content-container" data-v-c4b0d3cf><!--[--><!--]--><!----><main class="main" data-v-c4b0d3cf><div style="position:relative;" class="vp-doc _events_is-turbopack-really-10x-faster-than-vite" data-v-c4b0d3cf><div><h1 id="is-turbopack-really-10x-faster-than-vite" tabindex="-1">Is Turbopack really 10x Faster than Vite? <a class="header-anchor" href="#is-turbopack-really-10x-faster-than-vite" aria-label="Permalink to &quot;Is Turbopack really 10x Faster than Vite?&quot;">​</a></h1><p><code>Evan You</code> 在 <code>2022.11.1</code> 发布的一片<a href="https://github.com/yyx990803/vite-vs-next-turbo-hmr/discussions/8" target="_blank" rel="noreferrer">文章</a>。发布这篇文章的原因是 <code>Vercel</code> 在 <code>2022.10.26</code> 早上 <code>1.35</code> 的时候发布的推文，在该推文介绍了 <code>Webpack</code> 下一任基于 <code>rust</code> 实现的继承者 <a href="https://turbo.build/" target="_blank" rel="noreferrer">Turbopack</a>， 官方声明:</p><ol><li>比 <code>Webpack</code> 快近乎 <code>700</code> 倍。</li><li>比 <code>Vite</code> 快 <code>10</code> 倍且甚至在更大的应用中差距将会达到 <code>20</code> 倍。</li><li>用 <code>Rust</code> 构建的原生增量架构。</li><li>支持 <code>RSC</code>。</li><li>支持 <code>TS</code>、<code>JSX</code>、<code>CSS</code> 等基础能力。</li></ol><p><img src="/twitter-vercel-claim.png" alt="vercel声称"></p><p>在此来简单了解一下 <code>Turbopack</code>，这个令人兴奋的构建工具</p><p>从 <code>github</code> 上可以看到 <code>Turbopack</code> 是由 <code>Webpack</code> 的作者 <code>Tobias Koppers</code> 领导的基于 <code>rust</code> 实现的构建工具(目前处于 <code>alpha</code> 阶段)</p><p><img src="/turbo-github-maintainer.png" alt="Webpack作者领导"></p><p>官方提供的 <a href="https://vercel.com/blog/turbopack" target="_blank" rel="noreferrer">文章</a> 主要阐述了 <code>Turbopack</code> 在 <code>有多快</code>、<code>为什么这么快</code>、<code>未来的打算</code> 的表现。</p><ul><li><p>在 <code>有多快</code> 小结中介绍了 <code>Turbopack</code> 为了获得尽可能获取最快的开发体验而建立全新的增量架构(<code>rust</code> 默认开启<a href="https://rustwiki.org/zh-CN/edition-guide/rust-2018/the-compiler/incremental-compilation-for-faster-compiles.html" target="_blank" rel="noreferrer">增量编译</a>的能力)，从测试结果上看取得不错的进展。</p></li><li><p>在 <code>为什么这么快</code> 小结中介绍了 <code>Turbopack</code> 架构结合了 <code>Turborepo</code> 和 <code>Bazel(Google)</code> 等工具的增量计算的创新，着重使用 <strong><code>缓存</code></strong> 来避免重复做同样的工作。 <code>Turbopack</code> 的缓存能力如下:</p><ol><li>细分到函数粒度的 <code>结果缓存</code>。可以 <code>缓存</code> 程序中的 <code>任意函数的结果</code>，只要确保函数的输入没有发生变化函数就不会被重复执行。这种细化的架构使程序在函数的执行层面上能够跳过大量的工作。</li><li>支持 <code>内存缓存</code>，未来还将有 <code>持久化缓存</code> 和 <code>远程缓存</code>。</li></ol><p><code>Evan You</code> 也对 <code>Turbopack</code> 拥有强大的 <strong><code>缓存</code></strong> 能力做了赞许，宣称未来在合适的时机里会使用 <code>Turbopack</code> 来取代 <code>esbuild</code> 和 <code>rollup</code>。 <img src="/youyuxi-turbo-cache-appreciation.png" alt="Evan You赞许Turbopack的缓存"></p></li><li><p>在 <code>未来的打算</code> 小结中介绍了 <code>Turbopack</code> 将被用于 <code>Next.js 13</code> 开发环境下提供快如闪电的 <code>HMR</code> 能力，并且支持原生 <code>RSC</code>、<code>TypeScript</code>、<code>JSX</code>、<code>CSS</code> 等能力。后续会逐步成为 <code>Next.js</code> 生产环节构建。同时也呼吁 <code>Webpack</code> 用户迁移到 <code>Turbopack</code> 以及共创 <code>Turbopack</code> 生态。</p></li></ul><p><strong><code>Turbopack</code> 引擎的工作原理</strong></p><p>在 Turbopack 驱动的程序中，可以将某些函数标记为“to be remembered”。当这些函数被调用时，Turbo 引擎会记住它们被调用的内容，以及它们返回的内容。然后它将其保存在内存缓存中。下面是一个简化的示例： <img src="/turbo-excute-line-1.png" alt="工作流1"> 首先在 api.ts​ 和 sdk.ts​ 这两个文件中调用 readFile。然后打包这些文件，将它们拼接在一起，最后得到 fullBundle。所有这些函数调用的结果都保存在缓存中以备后用。 <img src="/turbo-excute-line-2.png" alt="工作流2"></p><p>由于 <code>sdk.ts</code>​ 文件发生了变化，需要再次进行打包。而 <code>api.ts</code>​ 文件并没有改变。只需从 <code>api.ts</code> 缓存中读取结果并将其传递给 <code>concat</code>。因此，通过按需打包的流程来节省了大量时间。</p><p><code>Turbo</code> 引擎当前将其缓存存储在内存中。这意味着 <code>Turbo</code> 缓存时间将与程序进程运行时间保持一致。之后会计划将缓存进行持久化，保存到文件系统中或者保存到像 <code>Turborepo</code> 这样的 <code>远程缓存</code>中。这意味着 <code>Turbopack</code> 可以记住跨运行和机器完成的工作。</p><p>这种方法使 Turbopack 在计算应用的增量更新方面非常快速，优化了 Turbopack 以处理开发中的更新，这意味着 Dev server 将始终快速响应更改。</p><p>回到开头，<code>Evan You</code> 发布了标题的 <a href="https://github.com/yyx990803/vite-vs-next-turbo-hmr/discussions/8" target="_blank" rel="noreferrer">文章</a>。里面的内容以 &quot;探究 <code>Turbopack</code> 速度超出 <code>Vite</code> 十倍&quot; 为论点在各基准上进行测试。 <code>Evan You</code> 肯定了 <code>Turbopack</code> 更快了，但是并不会比 <code>Vite</code> 快 <code>十倍</code>，<code>Vercel</code> 对外营销的数据是不正确的。 <code>Evan You</code> 使用了 <code>Next 13</code>(搭载了 <code>Turbopack</code>) 和 <code>Vite 3.2</code> 来对比两者处理 <code>HMR</code> 的性能。以下比较基准</p><blockquote><p><code>root</code>：根节点组件。组件导入 <code>1000</code> 个不同的子组件并将它们一起渲染；</p><p><code>leaf</code>：叶节点组件。组件被根节点组件所导入，自身没有子组件。</p></blockquote><p><strong>1. 否开启 <code>RSC</code> ?</strong></p><p>最初的基准测试是在服务端模式下使用根组件和叶子组件测量 <code>Next 13</code> 的 <code>HMR</code> 性能。 结果表明，<code>Next 13</code> 在两种情况下实际上都较慢，并且对于叶子组件而言差异更为明显，测试方法和测试结果如下。后来 <code>Evan You</code> 也注意到了开启 <code>RSC</code> 进行比较对于 <code>Next 13</code> 来说并不公平。因此就使用客户端模式来进行测试，发现 <code>Next 13</code> 的 <code>HMR</code> 的确提升显著，比 <code>Vite</code> 快了有 <code>2x</code>，但并不会达到如 <code>Vercel</code> 营销宣传的 <code>10x</code>。</p><p><strong>2. <code>Vite</code> 对于 <code>React Transform</code> 是否是使用 <code>SWC(rust-based)</code> 而不是 <code>Babel(js-based)</code> 来进行解析?</strong></p><p><code>React HMR</code> 和 <code>JSX</code> 转换并不是与构建工具耦合，它可以通过 <code>Babel(js-based)</code>）或 <code>SWC(rust-based)</code> 来完成。<code>Esbuild</code> 也是可以转换 <code>JSX</code>，但缺乏对 <code>HMR</code> 的支持。<code>Vite</code> 对于处理 <code>React preset</code> 默认使用 <code>Babel</code> 来转换 <code>React HMR</code> 和 <code>JSX</code>。而 <code>SWC</code> 显然是比 <code>Babel</code> 快非常多(单个线程快了 <code>20x</code>, 多核快了 <code>70x</code>)。<code>Vite</code> 现阶段没有使用 <code>SWC</code> 的原因：</p><ol><li>安装体积过大。会添加繁重的包体积(自身 <code>58M</code> 的大小而 <code>Vite</code> 也就 <code>19M</code>)</li><li>一些用户需要依赖 <code>Babel</code> 的能力做转换，因此对于部分用户来说 <code>Babel</code> 是不可缺失的。</li></ol><p>当 <code>Vite</code> 基于 <code>SWC</code> 来进行解析时，得出的结论为 <code>Next/turbo</code> 在根组件比叶子组件慢 <code>4</code> 倍，而 <code>Vite</code> 只慢 <code>2.4</code> 倍。这意味着 <code>Vite HMR</code> 在更大的组件中可伸缩性更好。此外，切换到 <code>SWC</code> 还可以改善 <code>Vite</code> 在 <code>Vercel</code> 基准测试中的冷启动指标。</p><h4 id="vercel-的澄清" tabindex="-1"><code>Vercel</code> 的澄清 <a class="header-anchor" href="#vercel-的澄清" aria-label="Permalink to &quot;`Vercel` 的澄清&quot;">​</a></h4><p>在 <code>Evan You</code> 发布了基准测试之后，<code>Vercel</code> 发布了一篇博客文章，阐明了他们的基准方法，并将他们的基准提供给公众验证。<code>Evan You</code> 随即也吐槽了第一天就改这么做了。文章的关键点如下：</p><ol><li>在基准上测试 <code>Vite HMR</code> 性能的时候依旧是使用 <code>Babel</code>，而对于 <code>Turbopack</code> 和 <code>Webpack</code> 测试上使用了 <code>SWC</code>。这一点对于 <code>Vite</code> 来说是极为不公平的。</li><li><code>1000</code> 个组件案例的原始数字存在舍入问题——<code>Turbopack</code> 的 <code>15ms</code> 被舍入到 <code>0.01s</code>，而 <code>Vite</code> 的 <code>87ms</code> 被舍入到 <code>0.09s</code>。 当原始数字接近 <code>6</code> 倍时，这进一步被宣传为 <code>10</code> 倍的优势；</li><li><code>Vercel</code> 的基准测试使用更新模块的“浏览器评估时间”作为结束时间戳，而不是 <code>React</code> 组件重新渲染时间；</li><li>博客文章中图表显示，当总模块数超过 <code>30k</code> 时，<code>Turbopack</code> 可以比 <code>Vite</code> 快 <code>10</code> 倍。</li></ol><div class="tip custom-block"><p class="custom-block-title">Vercel 的澄清总结</p><p>如果以下所有条件都成立，“比 Vite 快 10 倍”的说法是成立的：</p><ol><li>Vite 没有使用相同的 SWC 转换。</li><li>应用包含超过 30k 个模块。</li><li>基准测试只测量热更新模块的评估时间，而不是实际应用更改的时间。</li></ol></div><p><strong>Even You 对 Vercel 澄清的看法：</strong></p><ol><li>对于绝大多数用户来说，<code>30k</code> 模块是极不可能的情况。使用 <code>SWC</code> 的 <code>Vite</code>，达到 <code>10</code> 倍要求所需的模块数量可能会变得更加不切实际。虽然理论上是可行的，但用它来营销 <code>Turbopack</code> 是不诚实的。</li><li>与理论上的“模块评估”时间相比，用户更关心 <code>端到端 HMR</code> 性能，即从保存到看到更改的时间。当看到“更新速度快 10 倍”时，普通用户会想到前者而不是后者，<code>Vercel</code> 在其营销中忽略了这一警告。实际上，<code>Next</code> 中服务端组件（默认）的端到端 <code>HMR</code> 比 <code>Vite</code> 中的慢。</li></ol><h4 id="对于-turbopack-竞品的看法" tabindex="-1">对于 <code>Turbopack</code> 竞品的看法 <a class="header-anchor" href="#对于-turbopack-竞品的看法" aria-label="Permalink to &quot;对于 `Turbopack` 竞品的看法&quot;">​</a></h4><h5 id="evan-you-的观点" tabindex="-1"><code>Evan You</code> 的观点 <a class="header-anchor" href="#evan-you-的观点" aria-label="Permalink to &quot;`Evan You` 的观点&quot;">​</a></h5><p><img src="/youyuxi-turbo-views.png" alt="观点"></p><p>简单来说新竞品的出现对于 <code>Vite</code> 来说是否是互补关系还取决于设计者的目标，<code>Turbopack</code> 的出现对于市面上所有构建工具来说是一个十分强劲的对手，构建能力方面相对于其他构建工具来说是较为优秀的，可以在市面上获取很不错的收益和地位。从 <code>Evan You</code> 的说法上可以看出 <code>Turbopack</code> 可以作为 <code>meta frameworks</code> 的基本构建工具或者可以作为开箱即用的<code>spa</code> 解决方案。</p><h5 id="anthony-fu-的观点-vite-的核心团队成员" tabindex="-1"><code>Anthony Fu</code> 的观点 - Vite 的核心团队成员 <a class="header-anchor" href="#anthony-fu-的观点-vite-的核心团队成员" aria-label="Permalink to &quot;`Anthony Fu` 的观点 - Vite 的核心团队成员&quot;">​</a></h5><p>好的设计对性能的影响远比语言带来的提升更大，语言性能的加成更像一个常量系数，单纯更换语言只能带来有限的提升。<code>Vite</code> 更吸引人的是其插件系统，和构建在上面的生态系统。这样才能将改进快速带给其他领域。目前市面上暂时没有看到很好的基于原生语言的插件系统实现（同时兼顾性能和扩展性），在 <code>Turbopack</code> 实现插件系统前无法评价，暂时先静观其变。</p><blockquote><p><a href="https://zhihu.com/question/562349205/answer/2733040669" target="_blank" rel="noreferrer">如何评价Vercel开源的使用Rust实现的Turbopack? – Anthony Fu的回答 – 知乎</a></p></blockquote><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>可以看出 <code>Anthony Fu</code> 评价一个构建工具主要从两方面考虑。第一个方面是性能要素，第二个方面是可扩展已有的生态。</p></div><h4 id="sean-larkin-的观点-webpack-的核心团队创始人" tabindex="-1"><code>Sean Larkin</code> 的观点 - Webpack 的核心团队创始人 <a class="header-anchor" href="#sean-larkin-的观点-webpack-的核心团队创始人" aria-label="Permalink to &quot;`Sean Larkin` 的观点 - Webpack 的核心团队创始人&quot;">​</a></h4><ol><li>在我看来 <code>Turbopack</code> 更多是给予 <code>SWC</code> 的能力而非由于其自身创新的能力，希望对方能表达得清楚一些。</li><li>我对 <code>Turborepo</code> 与 <code>Next</code> 的绑定程度感到失望。没办法， <code>Vercel</code> 需要挣到更多的天使资金。</li><li>普遍用户很难从 <code>Webpack</code> 迁移到 <code>Turbopack</code>。</li><li>我倾向于开发服务器上的模块仍然是打包后的，因为 <code>ESM</code> 比原始 <code>ESM</code> 慢。我需要剥离更多层，才能让独立的实现工作。</li><li>目前 <code>Turbopack</code> 还处于 <code>alpha</code> 阶段，所以我们要看开一点，但我仍然希望多做一些实事而少一些营销。</li><li>对于把 <code>Turbopack</code> 比作 <code>Webpack</code> 的继承者有失偏薄，如此营销显得虚伪且误导旁观者。作为继承者需要让 <code>Turbopack</code> 拥有 <code>Webpack</code> 所拥有的特性且能轻易的从 <code>Webpack</code> 迁移到 <code>Turbopack</code>。</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>对于把 <code>Turbopack</code> 比作 <code>Webpack</code> 的继承者是不合理的，这是两个不一样的工具，是共存关系而不是取代关系。这里面蕴含了大量的营销手段，借助 <code>Webpack</code> 创始人的身份来推销新构建工具，让一部分社区人士认为这是 <code>Webpack</code> 创始人 <code>wSokra</code> 创建的新构建工具并作为 <code>Webpack</code> 的下一代构建工具，在极短时间内获取社区的广泛关注。</p></div><h5 id="lee-robinson-的回复-vercel-公司开发者体验副总裁" tabindex="-1">Lee Robinson 的回复 - Vercel 公司开发者体验副总裁 <a class="header-anchor" href="#lee-robinson-的回复-vercel-公司开发者体验副总裁" aria-label="Permalink to &quot;Lee Robinson 的回复 - Vercel 公司开发者体验副总裁&quot;">​</a></h5><ol><li>没有 <code>SWC</code> 当然是不可能的，<code>Vercel</code> 研发团队前期在 <code>SWC</code> 上做了大量工作。</li><li>现阶段先支持 <code>Next 13</code> 版本，后续目标是为所有框架提供支持。</li><li><code>Webpack</code> 迁移到 <code>Turbopack</code> 还需要花费时间，并且我们确信我们会拥抱社区的(插件扩展能力)。</li></ol><h4 id="wsokra-的观点-webpack-和-turbopack-的创始人" tabindex="-1"><code>wSokra</code> 的观点 - Webpack 和 Turbopack 的创始人 <a class="header-anchor" href="#wsokra-的观点-webpack-和-turbopack-的创始人" aria-label="Permalink to &quot;`wSokra` 的观点 - Webpack 和 Turbopack 的创始人&quot;">​</a></h4><ol><li>目前把 <code>Turbopack</code> 比作 <code>Webpack</code> 的继承者是一种营销手段，且 <code>Webpack</code> 是肯定不会被弃用的。但 <code>Turbopack</code> 的更大愿景是提供 <code>95%</code> 的 <code>webpack</code> 的特性、思想(包括扩展能力)并且使其容易迁移。</li><li><code>Turbopack</code> 渐进式的构建仅取决于改变文件的大小而不取决于总编译大小。对于 <code>Webpack</code> 来说，是按照总编译大小来做增量构建的，因为 <code>Webpack</code> 需要在缓存中检索所有的模块。后续还会初始构建流程中进一步提升 <code>Turbopack</code> 的构建速度。</li><li>后续不再关心这个话题，因为无论如何每一个人都会去评估这个价值。作为两个项目( <code>Webpack</code> &amp; <code>Turbopack</code> )的创始人，两个项目都是有价值的，而我在社区评估两者的价值会放大这件事情，对两个项目用户或支持者并不友好。</li></ol></div></div></main><footer class="VPDocFooter" data-v-c4b0d3cf data-v-face870a><!--[--><!--]--><div class="edit-info" data-v-face870a><div class="edit-link" data-v-face870a><a class="VPLink link edit-link-button" href="https://github.com/XiSenao/vrite/src/events/is-turbopack-really-10x-faster-than-vite.md" target="_blank" rel="noreferrer" data-v-face870a data-v-8f4dc553><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-face870a><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page on GitHub<!--]--><!----></a></div><!----></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-b2cf3e0b data-v-f7fc41f4><div class="container" data-v-f7fc41f4><p class="message" data-v-f7fc41f4>Released under the MIT License.</p><p class="copyright" data-v-f7fc41f4>Copyright © 2019-present XiSenao</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"plugin_outside_vite-plugin-inspect.md\":\"4786a7bc\",\"guide_overview.md\":\"fb5e260e\",\"events_is-turbopack-really-10x-faster-than-vite.md\":\"c82d7d7e\",\"other_why-does-zsh-start-slowly.md\":\"de29f745\",\"guide_getting-started.md\":\"549f532b\",\"other_leedcode.md\":\"f131294b\",\"advanced_comparison-of-plugin-mechanisms.md\":\"04b535db\",\"other_diary.md\":\"2398bd8e\",\"index.md\":\"10c8799d\",\"reference_module-order.md\":\"8149d589\",\"other_configuration-item-ts-type-prompt-in-vite.md\":\"3779a2c9\",\"advanced_rewrite-prebuild-module-path.md\":\"ab9c88e5\",\"other_optimization-and-deoptimization-of-js.md\":\"2aaf915c\",\"plugin_inside_plugin-legacy.md\":\"eec53b3a\",\"reference_config-resolve.md\":\"ad8c0669\",\"reference_hmr.md\":\"cff19ef4\",\"reference_render.md\":\"01df6cfe\",\"reference_module-resolve.md\":\"275f88ad\",\"reference_optimize.md\":\"18625af3\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Vrite\",\"description\":\"Vite Art\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/overview\",\"activeMatch\":\"/guide/\"},{\"text\":\"Plugin\",\"link\":\"/plugin/inside/plugin-legacy\",\"activeMatch\":\"/plugin/\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"Guide\",\"collapsed\":false,\"items\":[{\"text\":\"Overview\",\"link\":\"/guide/overview\"},{\"text\":\"Getting Started\",\"link\":\"/guide/getting-started\"}]},{\"text\":\"Reference\",\"collapsed\":false,\"items\":[{\"text\":\"Config Resolve\",\"link\":\"/reference/config-resolve\"},{\"text\":\"Module Resolve\",\"link\":\"/reference/module-resolve\"},{\"text\":\"Optimized\",\"link\":\"/reference/optimize\"},{\"text\":\"Module Order\",\"link\":\"/reference/module-order\"},{\"text\":\"HMR\",\"link\":\"/reference/hmr\"}]},{\"text\":\"Advanced\",\"collapsed\":false,\"items\":[{\"text\":\"Plugin Mechanisms\",\"link\":\"/advanced/comparison-of-plugin-mechanisms\"},{\"text\":\"Rewrite Path\",\"link\":\"/advanced/rewrite-prebuild-module-path\"}]},{\"text\":\"Events\",\"collapsed\":false,\"items\":[{\"text\":\"Turbopack vs Vite\",\"link\":\"/events/is-turbopack-really-10x-faster-than-vite\"}]},{\"text\":\"Other\",\"collapsed\":false,\"items\":[{\"text\":\"TS Prompt Support\",\"link\":\"/other/configuration-item-ts-type-prompt-in-vite\"},{\"text\":\"JS optimize & deoptimize\",\"link\":\"/other/optimization-and-deoptimization-of-js\"},{\"text\":\"Why Does ZSH Start Slowly\",\"link\":\"/other/why-does-zsh-start-slowly\"}]}],\"/plugin/\":[{\"text\":\"Plugin\",\"items\":[{\"text\":\"Inside Plugin\",\"items\":[{\"text\":\"@vitejs/plugin-legacy\",\"link\":\"/plugin/inside/plugin-legacy\"}]},{\"text\":\"Outside Plugin\",\"items\":[{\"text\":\"vite-plugin-inspect\",\"link\":\"/plugin/outside/vite-plugin-inspect\"}]}]}]},\"editLink\":{\"pattern\":\"https://github.com/XiSenao/vrite/src/:path\",\"text\":\"Edit this page on GitHub\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2019-present XiSenao\"},\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"8J64VVRP8K\",\"apiKey\":\"a18e2f4cc5665f6602c5631fd868adfd\",\"indexName\":\"vitepress\"}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/XiSenao\"}]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":true}")</script>
    
  </body>
</html>